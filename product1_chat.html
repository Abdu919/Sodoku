<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุชุงุฑูุฎ ุงูููููุฉ</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>ูุณุงุนุฏ ุชุงุฑูุฎ ุงูููููุฉ</h1>
        <div class="chatbox">
            <div id="chat-log" class="chat-log">
                <div class="bot-message">ูุฑุญุจุง! ูููููู ุงูุงุฌุงุจุฉ ุนู ุฃุณุฆูุฉ ููุฑุฑ ุชุงุฑูุฎ ุงูููููุฉ. ุงูุณุฎ ูุฃูุตู ุณุคุงูู ูู ุงููุญุงุฏุซุฉ.</div>
            </div>
            <div class="chat-input">
                <input type="text" id="user-input" placeholder="ุฃูุชุจุ ุงูุณุฎ ุณุคุงูู ููุง...">
                <button id="send-button">ุฅุฑุณุงู</button>
            </div>
        </div>
        <a href="index.html" class="back-link">โ ุงูุนูุฏุฉ ุงูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ</a>
    </div>

    <script>
        const API_URL = 'https://masnadk.work.gd';

        // Retrieve the JWT from localStorage
        let token = localStorage.getItem('token');

        if (!token) {
            window.location.href = 'index.html';  // Redirect to login if no token
        }

        function fetchWithAuth(url, options = {}) {
            options.headers = {
                ...options.headers,
                'Authorization': `Bearer ${token}`
            };
            return fetch(url, options);
        }

        document.getElementById('send-button').addEventListener('click', sendMessage);
        document.getElementById('user-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        function sendMessage() {
            const message = document.getElementById('user-input').value.trim();
            if (message === '') return;

            fetchWithAuth(`${API_URL}/get_answer`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ message: message })
            })
            .then(response => {
                if (response.status === 403) {
                    alert('ููุฏ ูุตูุช ุฅูู ุงูุญุฏ ุงูุฃูุตู ูู ุงูุฑุณุงุฆู ููุฐู ุงูุฌูุณุฉ.');
                    window.location.href = 'index.html';
                    return;
                }
                return response.json();
            })
            .then(data => {
                if (data) {
                    const chatLog = document.getElementById('chat-log');
                    const botMessageDiv = document.createElement('div');
                    botMessageDiv.classList.add('bot-message');
                    botMessageDiv.textContent = data.answer;
                    chatLog.appendChild(botMessageDiv);

                    // Scroll to the bottom of the chat log
                    chatLog.scrollTop = chatLog.scrollHeight;

                    // Update token in localStorage
                    token = data.new_token;
                    localStorage.setItem('token', token);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('ุญุฏุซ ุฎุทุฃ. ุญุงูู ูุฑุฉ ุงุฎุฑู.');
            });
        }
    </script>
</body>
<footer>
    <div class="footer-content">
        <ul class="social-links">
            <li><a href="https://facebook.com">Facebook</a></li>
            <li><a href="https://instagram.com">Instagram</a></li>
        </ul>
        <p>&copy; 2024 Made with ๐ by Seniors.</p>
    </div>
</footer>
</html>
